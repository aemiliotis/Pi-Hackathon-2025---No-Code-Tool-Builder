<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi No-Code Tool Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .auth-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .main-content {
            display: none;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .tool-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .builder-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .tool-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .tool-card:hover {
            transform: translateY(-2px);
        }

        .tool-card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .tool-card p {
            color: #666;
            margin-bottom: 15px;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
        }

        .preview-area {
            background: white;
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            text-align: center;
            color: #666;
        }

        .field-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .field-item .field-info {
            flex: 1;
        }

        .field-item .field-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .pi-login-btn {
            background: #f7931a;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pi-login-btn:hover {
            background: #e8840f;
            transform: translateY(-2px);
        }

        .user-info {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .tool-builder {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Pi No-Code Tool Builder</h1>
            <p>Create powerful tools without writing code - Powered by Pi Network</p>
        </div>

        <!-- Authentication Section -->
        <div id="auth-section" class="auth-section">
            <h2>Welcome to Pi No-Code Builder</h2>
            <p>Connect with your Pi Network account to start building amazing tools!</p>
            <br>
            <button id="pi-login-btn" class="pi-login-btn" onclick="loginWithPi()">
                ü•ß Login with Pi Network
            </button>
            <div id="auth-status"></div>
        </div>

        <!-- Main Application -->
        <div id="main-content" class="main-content">
            <!-- User Info -->
            <div id="user-info" class="user-info" style="display: none;">
                <h3>Welcome back!</h3>
                <p id="user-details"></p>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('builder')">üîß Tool Builder</button>
                <button class="nav-tab" onclick="showTab('my-tools')">üìã My Tools</button>
                <button class="nav-tab" onclick="showTab('explore')">üåü Explore Tools</button>
            </div>

            <div class="tab-content">
                <!-- Tool Builder Tab -->
                <div id="builder-tab" class="tab-pane active">
                    <h2>Create a New Tool</h2>
                    <div class="tool-builder">
                        <div class="builder-section">
                            <h3>Tool Configuration</h3>
                            <form id="tool-form">
                                <div class="form-group">
                                    <label for="tool-name">Tool Name</label>
                                    <input type="text" id="tool-name" placeholder="Enter tool name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tool-description">Description</label>
                                    <textarea id="tool-description" rows="3" placeholder="Describe what your tool does"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tool-type">Tool Type</label>
                                    <select id="tool-type" onchange="updateToolType()">
                                        <option value="form">üìù Form Tool</option>
                                        <option value="calculator">üßÆ Calculator</option>
                                        <option value="converter">üîÑ Unit Converter</option>
                                        <option value="generator">üìÑ Text Generator</option>
                                        <option value="survey">üìä Survey Tool</option>
                                        <option value="quiz">üß† Quiz Tool</option>
                                        <option value="poll">üó≥Ô∏è Poll Tool</option>
                                        <option value="scheduler">üìÖ Event Scheduler</option>
                                        <option value="tracker">üìà Progress Tracker</option>
                                        <option value="validator">‚úÖ Data Validator</option>
                                    </select>
                                </div>

                                <div id="form-fields-section">
                                    <h4>Form Fields</h4>
                                    <div id="fields-list"></div>
                                    <button type="button" class="btn" onclick="addField()">+ Add Field</button>
                                </div>

                                <div class="form-group">
                                    <button type="button" class="btn" onclick="saveAndPreviewTool()">üíæ Save & Preview</button>
                                    <button type="button" class="btn" onclick="publishTool()">üöÄ Publish Tool</button>
                                </div>
                            </form>
                        </div>

                        <div class="builder-section">
                            <h3>Live Preview</h3>
                            <div id="tool-preview" class="preview-area">
                                <p>Your tool preview will appear here...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Tools Tab -->
                <div id="my-tools-tab" class="tab-pane">
                    <h2>My Created Tools</h2>
                    <div id="my-tools-list">
                        <p>Loading your tools...</p>
                    </div>
                </div>

                <!-- Explore Tools Tab -->
                <div id="explore-tab" class="tab-pane">
                    <h2>Explore Public Tools</h2>
                    <div id="public-tools-list">
                        <p>Loading public tools...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let currentTool = {
            name: '',
            description: '',
            type: 'form',
            fields: []
        };

        // Authentication functions
        async function loginWithPi() {
            try {
                // For now, simulate Pi login - in real implementation, use Pi SDK
                const mockUser = {
                    uid: 'pi_user_' + Date.now(),
                    username: 'PiUser' + Math.floor(Math.random() * 1000),
                    accessToken: 'mock_token_' + Date.now()
                };
                
                currentUser = mockUser;
                showAuthenticatedState();
                loadUserTools();
                
                showAlert('Successfully logged in with Pi Network!', 'success');
            } catch (error) {
                showAlert('Login failed: ' + error.message, 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('main-content').style.display = 'none';
            document.getElementById('user-info').style.display = 'none';
        }

        function showAuthenticatedState() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('user-details').textContent = `Logged in as: ${currentUser.username}`;
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-pane').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Load tab-specific content
            if (tabName === 'my-tools') {
                loadUserTools();
            } else if (tabName === 'explore') {
                loadPublicTools();
            }
        }

        // Tool building functions
        function updateToolType() {
            const toolType = document.getElementById('tool-type').value;
            currentTool.type = toolType;
            
            // Show/hide form fields section based on tool type
            const fieldsSection = document.getElementById('form-fields-section');
            if (toolType === 'form') {
                fieldsSection.style.display = 'block';
            } else {
                fieldsSection.style.display = 'none';
            }
            
            updatePreview();
        }

        function addField() {
            const fieldId = 'field_' + Date.now();
            const fieldHtml = `
                <div class="field-item" id="${fieldId}">
                    <div class="field-info">
                        <input type="text" placeholder="Field Label" onchange="updateFieldLabel('${fieldId}', this.value)">
                        <select onchange="updateFieldType('${fieldId}', this.value)">
                            <option value="text">Text Input</option>
                            <option value="number">Number Input</option>
                            <option value="email">Email Input</option>
                            <option value="textarea">Text Area</option>
                            <option value="select">Dropdown</option>
                        </select>
                    </div>
                    <div class="field-actions">
                        <button type="button" class="btn btn-small" onclick="removeField('${fieldId}')">Remove</button>
                    </div>
                </div>
            `;
            
            document.getElementById('fields-list').insertAdjacentHTML('beforeend', fieldHtml);
            
            // Add to current tool
            currentTool.fields.push({
                id: fieldId,
                label: '',
                type: 'text',
                required: false
            });
            
            updatePreview();
        }

        function removeField(fieldId) {
            document.getElementById(fieldId).remove();
            currentTool.fields = currentTool.fields.filter(field => field.id !== fieldId);
            updatePreview();
        }

        function updateFieldLabel(fieldId, label) {
            const field = currentTool.fields.find(f => f.id === fieldId);
            if (field) {
                field.label = label;
                updatePreview();
            }
        }

        function updateFieldType(fieldId, type) {
            const field = currentTool.fields.find(f => f.id === fieldId);
            if (field) {
                field.type = type;
                updatePreview();
            }
        }

        function updatePreview() {
            const preview = document.getElementById('tool-preview');
            const toolName = document.getElementById('tool-name').value || 'Untitled Tool';
            const toolDescription = document.getElementById('tool-description').value || 'No description';
            
            let previewHtml = `
                <div style="text-align: left;">
                    <h3>${toolName}</h3>
                    <p>${toolDescription}</p>
                    <hr style="margin: 20px 0;">
            `;

            if (currentTool.type === 'form') {
                previewHtml += '<form>';
                currentTool.fields.forEach(field => {
                    if (field.label) {
                        previewHtml += `
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">${field.label}</label>
                        `;
                        
                        if (field.type === 'textarea') {
                            previewHtml += `<textarea style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" rows="3"></textarea>`;
                        } else if (field.type === 'select') {
                            previewHtml += `
                                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                    <option>Option 1</option>
                                    <option>Option 2</option>
                                </select>
                            `;
                        } else {
                            previewHtml += `<input type="${field.type}" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">`;
                        }
                        
                        previewHtml += '</div>';
                    }
                });
                previewHtml += '<button type="submit" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Submit</button>';
                previewHtml += '</form>';
            } else {
                previewHtml += `<p>Preview for ${currentTool.type} tool will be implemented here.</p>`;
            }

            previewHtml += '</div>';
            preview.innerHTML = previewHtml;
        }

        async function saveAndPreviewTool() {
            const toolData = {
                name: document.getElementById('tool-name').value,
                description: document.getElementById('tool-description').value,
                type: currentTool.type,
                fields: currentTool.fields,
                creator: currentUser.uid,
                published: false
            };

            try {
                const response = await fetch('/api/tools', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentUser.accessToken}`
                    },
                    body: JSON.stringify(toolData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showAlert('Tool saved successfully!', 'success');
                    currentTool.id = result.id;
                } else {
                    throw new Error('Failed to save tool');
                }
            } catch (error) {
                showAlert('Error saving tool: ' + error.message, 'error');
            }
        }

        async function publishTool() {
            if (!currentTool.id) {
                await saveAndPreviewTool();
            }

            try {
                const response = await fetch(`/api/tools/${currentTool.id}/publish`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.accessToken}`
                    }
                });

                if (response.ok) {
                    showAlert('Tool published successfully! It\'s now available to the public.', 'success');
                    loadUserTools();
                } else {
                    throw new Error('Failed to publish tool');
                }
            } catch (error) {
                showAlert('Error publishing tool: ' + error.message, 'error');
            }
        }

        async function loadUserTools() {
            if (!currentUser) return;

            try {
                const response = await fetch('/api/tools/my', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.accessToken}`
                    }
                });

                if (response.ok) {
                    const tools = await response.json();
                    displayUserTools(tools);
                } else {
                    throw new Error('Failed to load tools');
                }
            } catch (error) {
                document.getElementById('my-tools-list').innerHTML = '<p>Error loading tools: ' + error.message + '</p>';
            }
        }

        async function loadPublicTools() {
            try {
                const response = await fetch('/api/tools/public');
                
                if (response.ok) {
                    const tools = await response.json();
                    displayPublicTools(tools);
                } else {
                    throw new Error('Failed to load public tools');
                }
            } catch (error) {
                document.getElementById('public-tools-list').innerHTML = '<p>Error loading public tools: ' + error.message + '</p>';
            }
        }

        function displayUserTools(tools) {
            const container = document.getElementById('my-tools-list');
            
            if (tools.length === 0) {
                container.innerHTML = '<p>You haven\'t created any tools yet. Start building your first tool!</p>';
                return;
            }

            let html = '';
            tools.forEach(tool => {
                html += `
                    <div class="tool-card">
                        <h3>${tool.name}</h3>
                        <p>${tool.description}</p>
                        <p><strong>Type:</strong> ${tool.type} | <strong>Status:</strong> ${tool.published ? 'Published' : 'Draft'}</p>
                        <div class="tool-actions">
                            <button class="btn btn-small" onclick="editTool(${tool.id})">Edit</button>
                            <button class="btn btn-small" onclick="viewTool(${tool.id})">View</button>
                            ${!tool.published ? '<button class="btn btn-small" onclick="publishToolById(' + tool.id + ')">Publish</button>' : ''}
                            <button class="btn btn-small btn-secondary" onclick="deleteTool(${tool.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function displayPublicTools(tools) {
            const container = document.getElementById('public-tools-list');
            
            if (tools.length === 0) {
                container.innerHTML = '<p>No public tools available yet.</p>';
                return;
            }

            let html = '';
            tools.forEach(tool => {
                html += `
                    <div class="tool-card">
                        <h3>${tool.name}</h3>
                        <p>${tool.description}</p>
                        <p><strong>Type:</strong> ${tool.type} | <strong>Creator:</strong> ${tool.creator_name}</p>
                        <div class="tool-actions">
                            <button class="btn btn-small" onclick="useTool(${tool.id})">Use Tool</button>
                            <button class="btn btn-small" onclick="viewTool(${tool.id})">View Details</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        async function useTool(toolId) {
            // Open tool in new window/tab for execution
            window.open(`/tool/${toolId}`, '_blank');
        }

        async function viewTool(toolId) {
            // Implementation for viewing tool details
            showAlert('View tool functionality will be implemented', 'success');
        }

        async function editTool(toolId) {
            // Implementation for editing existing tool
            showAlert('Edit tool functionality will be implemented', 'success');
        }

        async function deleteTool(toolId) {
            if (confirm('Are you sure you want to delete this tool?')) {
                try {
                    const response = await fetch(`/api/tools/${toolId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${currentUser.accessToken}`
                        }
                    });

                    if (response.ok) {
                        showAlert('Tool deleted successfully!', 'success');
                        loadUserTools();
                    } else {
                        throw new Error('Failed to delete tool');
                    }
                } catch (error) {
                    showAlert('Error deleting tool: ' + error.message, 'error');
                }
            }
        }

        async function publishToolById(toolId) {
            try {
                const response = await fetch(`/api/tools/${toolId}/publish`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.accessToken}`
                    }
                });

                if (response.ok) {
                    showAlert('Tool published successfully!', 'success');
                    loadUserTools();
                } else {
                    throw new Error('Failed to publish tool');
                }
            } catch (error) {
                showAlert('Error publishing tool: ' + error.message, 'error');
            }
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Update preview when form fields change
            document.getElementById('tool-name').addEventListener('input', updatePreview);
            document.getElementById('tool-description').addEventListener('input', updatePreview);
            
            // Initialize preview
            updatePreview();
        });
    </script>
</body>
</html>

